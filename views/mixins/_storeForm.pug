mixin storeForm(store = {})
  form(action=`/add/${store._id || ''}` method="POST" enctype="multipart/form-data")
    .mb-3
      label(for="name" class="form-label") Name
      input(class="form-control" type="text" id="name" name="name" value=store.name required)
    .mb-3
      label(for="description" class="form-label") Description
      textarea(class="form-control" id="description" name="description")= store.description
    .mb-3
      label(for="photo" class="form-label") Photo
      input(class="form-control" type="file" name="photo" id="photo" accept="image/gif, image/png, image/jpeg")
      if store.photo
        img(src=`/uploads/${store.photo}` alt=store.name width=200)
    .mb-3
      label(for="address" class="form-label") Address
      input(class="form-control" type="text" id="address" name="address" value=store.address required)
    .mb-3
      label(for="latitude" class="form-label") Latitude
      input(class="form-control" type="text" id="latitude" name="latitude" value=store.latitude required)
    .mb-3
      label(for="longitude" class="form-label") Longitude
      input(class="form-control" type="text" id="longitude" name="longitude" value=store.longitude required)
    .mb-3
      label(for="tags" class="form-label") Options:
      .mb-3.form-check
        - const choices = ['Wifi', 'Open Late', 'Family Friendly', 'Vegan']
        - const tags = store.tags || []
        each choice in choices
          .form-check
            input(class="form-check-input" type="checkbox" id=choice value=choice name="tags" checked=(tags.includes(choice)))
            label(for=choice class="form-check-label") #{choice}
    .mb-3
      label(for="closedDays" class="form-label") Closed Days
      - const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
      - const closedDays = store.closedDays || []
      each day in daysOfWeek
        .form-check
          input.form-check-input(type="checkbox" id=day name="closedDays" value=day checked=(closedDays.includes(day)))
          label.form-check-label(for=day) #{day}
    .mb-3
      label(for="timeSlots" class="form-label") Time Slots
      .time-slots
        .time-slot-template.hidden
          .mb-3
            label(for="timeSlot" class="form-label") Time Slot
            select(class="form-control" name="timeSlots[][slot][]" onchange="checkDuplicateSlots(this)")
              option(value="") Select a time slot
              option(value="09:00-11:00") 09:00 - 11:00
              option(value="11:00-13:00") 11:00 - 13:00
              option(value="13:00-15:00") 13:00 - 15:00
              option(value="15:00-17:00") 15:00 - 17:00
              option(value="17:00-19:00") 17:00 - 19:00
              option(value="19:00-21:00") 19:00 - 21:00
          .mb-3
            label(for="timeSlotMaxReservations" class="form-label") Max Reservations
            input(class="form-control" type="number" name="timeSlots[][maxReservations]" required)
          button(type="button" class="btn btn-danger remove-time-slot") Remove
        button(type="button" class="btn btn-primary add-time-slot") Add Time Slot
    button(type="submit" class="btn btn-primary") Save

  script.
    document.addEventListener('DOMContentLoaded', function() {
      const timeSlotTemplate = document.querySelector('.time-slot-template');
      const timeSlotsContainer = document.querySelector('.time-slots');
      const addTimeSlotButton = document.querySelector('.add-time-slot');

      addTimeSlotButton.addEventListener('click', function() {
        const newTimeSlot = timeSlotTemplate.cloneNode(true);
        newTimeSlot.classList.remove('hidden', 'time-slot-template');
        timeSlotsContainer.insertBefore(newTimeSlot, addTimeSlotButton);
      });

      timeSlotsContainer.addEventListener('click', function(event) {
        if (event.target.classList.contains('remove-time-slot')) {
          event.target.closest('.time-slot').remove();
        }
      });
    });

    function checkDuplicateSlots(selectElement) {
      const selectedValue = selectElement.value;
      const allSelects = document.querySelectorAll('select[name^="timeSlots"]');
      allSelects.forEach(select => {
        if (select !== selectElement && select.value === selectedValue) {
          alert('This time slot is already selected. Please choose a different one.');
          selectElement.value = '';
        }
      });
    }